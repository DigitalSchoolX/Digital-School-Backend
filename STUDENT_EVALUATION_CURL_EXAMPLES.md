# V√≠ D·ª• cURL Commands - API ƒê√°nh Gi√° Ti·∫øt H·ªçc C·ªßa H·ªçc Sinh

## Chu·∫©n b·ªã
```bash
# Thi·∫øt l·∫≠p token h·ªçc sinh
export STUDENT_TOKEN="your_student_jwt_token_here"
export BASE_URL="http://localhost:5000/api"

# Thi·∫øt l·∫≠p lesson ID ƒë·ªÉ test
export LESSON_ID="675a1b2c3d4e5f6789012345"
export EVALUATION_ID="675a1b2c3d4e5f6789012346"
```

---

## 1. üîç Ki·ªÉm tra c√≥ th·ªÉ ƒë√°nh gi√° ti·∫øt h·ªçc kh√¥ng

```bash
curl -X GET "${BASE_URL}/student-evaluations/lessons/${LESSON_ID}/can-evaluate" \
  -H "Authorization: Bearer ${STUDENT_TOKEN}" \
  -H "Content-Type: application/json" | jq
```

**Response Success:**
```json
{
  "success": true,
  "canEvaluate": true,
  "message": "H·ªçc sinh c√≥ th·ªÉ ƒë√°nh gi√° ti·∫øt h·ªçc n√†y",
  "data": {
    "lesson": {
      "lessonId": "582827_20241219_0001",
      "scheduledDate": "2024-12-19T00:00:00.000Z",
      "actualDate": "2024-12-19T07:00:00.000Z",
      "topic": "ƒê·∫°o h√†m c·ªßa h√†m s·ªë",
      "status": "completed"
    },
    "class": "12A1",
    "subject": {
      "name": "To√°n h·ªçc",
      "code": "MATH"
    },
    "teacher": {
      "name": "Nguy·ªÖn VƒÉn Nam",
      "email": "nguyenvannam@school.edu.vn"
    }
  }
}
```

---

## 2. üìù T·∫°o ƒë√°nh gi√° ti·∫øt h·ªçc m·ªõi

```bash
curl -X POST "${BASE_URL}/student-evaluations/lessons/${LESSON_ID}/evaluate" \
  -H "Authorization: Bearer ${STUDENT_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "teachingClarity": 4,
    "teachingSupport": 5,
    "teacherInteraction": 4,
    "completedWell": true,
    "comments": "Ti·∫øt h·ªçc r·∫•t hay, gi√°o vi√™n gi·∫£i th√≠ch d·ªÖ hi·ªÉu. T√¥i ƒë√£ hi·ªÉu ƒë∆∞·ª£c c√°ch t√≠nh ƒë·∫°o h√†m c∆° b·∫£n."
  }' | jq
```

**Response Success:**
```json
{
  "success": true,
  "message": "ƒê√°nh gi√° ti·∫øt h·ªçc th√†nh c√¥ng",
  "data": {
    "evaluationId": "675a1b2c3d4e5f6789012345",
    "lesson": {
      "lessonId": "582827_20241219_0001",
      "scheduledDate": "2024-12-19T00:00:00.000Z",
      "topic": "ƒê·∫°o h√†m c·ªßa h√†m s·ªë"
    },
    "class": "12A1",
    "subject": {
      "name": "To√°n h·ªçc",
      "code": "MATH"
    },
    "teacher": {
      "name": "Nguy·ªÖn VƒÉn Nam",
      "email": "nguyenvannam@school.edu.vn"
    },
    "evaluation": {
      "teachingClarity": 4,
      "teachingSupport": 5,
      "teacherInteraction": 4,
      "overallRating": 4.3
    },
    "studentSelfAssessment": {
      "completedWell": true,
      "reason": null
    },
    "comments": "Ti·∫øt h·ªçc r·∫•t hay, gi√°o vi√™n gi·∫£i th√≠ch d·ªÖ hi·ªÉu. T√¥i ƒë√£ hi·ªÉu ƒë∆∞·ª£c c√°ch t√≠nh ƒë·∫°o h√†m c∆° b·∫£n.",
    "evaluatedAt": "2024-12-20T10:30:00.000Z"
  }
}
```

---

## 3. ‚úèÔ∏è C·∫≠p nh·∫≠t ƒë√°nh gi√°

```bash
curl -X PUT "${BASE_URL}/student-evaluations/${EVALUATION_ID}" \
  -H "Authorization: Bearer ${STUDENT_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "teachingClarity": 5,
    "comments": "C·∫≠p nh·∫≠t: Sau khi v·ªÅ nh√† l√†m b√†i t·∫≠p, t√¥i th·∫•y gi√°o vi√™n gi·∫£i th√≠ch r·∫•t r√µ r√†ng v√† chi ti·∫øt."
  }' | jq
```

---

## 4. üìã L·∫•y danh s√°ch ƒë√°nh gi√° c·ªßa h·ªçc sinh

```bash
# L·∫•y t·∫•t c·∫£ ƒë√°nh gi√°
curl -X GET "${BASE_URL}/student-evaluations" \
  -H "Authorization: Bearer ${STUDENT_TOKEN}" | jq

# L·∫•y ƒë√°nh gi√° v·ªõi filter v√† pagination
curl -X GET "${BASE_URL}/student-evaluations?page=1&limit=5&startDate=2024-12-01&endDate=2024-12-31" \
  -H "Authorization: Bearer ${STUDENT_TOKEN}" | jq

# L·ªçc theo m√¥n h·ªçc
curl -X GET "${BASE_URL}/student-evaluations?subjectId=675a1b2c3d4e5f6789012347" \
  -H "Authorization: Bearer ${STUDENT_TOKEN}" | jq
```

---

## 5. üîç L·∫•y chi ti·∫øt m·ªôt ƒë√°nh gi√°

```bash
curl -X GET "${BASE_URL}/student-evaluations/${EVALUATION_ID}" \
  -H "Authorization: Bearer ${STUDENT_TOKEN}" \
  -H "Content-Type: application/json" | jq
```

---

## 6. üìö L·∫•y danh s√°ch ti·∫øt h·ªçc c√≥ th·ªÉ ƒë√°nh gi√°

```bash
# L·∫•y t·∫•t c·∫£ ti·∫øt h·ªçc c√≥ th·ªÉ ƒë√°nh gi√°
curl -X GET "${BASE_URL}/student-evaluations/lessons/evaluable" \
  -H "Authorization: Bearer ${STUDENT_TOKEN}" | jq

# L·ªçc theo th·ªùi gian v√† m√¥n h·ªçc
curl -X GET "${BASE_URL}/student-evaluations/lessons/evaluable?startDate=2024-12-01&endDate=2024-12-31&subjectId=675a1b2c3d4e5f6789012347" \
  -H "Authorization: Bearer ${STUDENT_TOKEN}" | jq

# V·ªõi pagination
curl -X GET "${BASE_URL}/student-evaluations/lessons/evaluable?page=1&limit=10" \
  -H "Authorization: Bearer ${STUDENT_TOKEN}" | jq
```

---

## üß™ Test Cases - C√°c Tr∆∞·ªùng H·ª£p L·ªói

### 1. ƒê√°nh gi√° ti·∫øt h·ªçc ch∆∞a ho√†n th√†nh
```bash
# Gi·∫£ s·ª≠ LESSON_ID_NOT_COMPLETED l√† lesson c√≥ status 'scheduled'
export LESSON_ID_NOT_COMPLETED="675a1b2c3d4e5f6789012999"

curl -X POST "${BASE_URL}/student-evaluations/lessons/${LESSON_ID_NOT_COMPLETED}/evaluate" \
  -H "Authorization: Bearer ${STUDENT_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "teachingClarity": 4,
    "teachingSupport": 5,
    "teacherInteraction": 4,
    "completedWell": true
  }' | jq
```

**Expected Response (403):**
```json
{
  "success": false,
  "message": "Lesson is not completed yet"
}
```

### 2. ƒê√°nh gi√° v·ªõi rating kh√¥ng h·ª£p l·ªá
```bash
curl -X POST "${BASE_URL}/student-evaluations/lessons/${LESSON_ID}/evaluate" \
  -H "Authorization: Bearer ${STUDENT_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "teachingClarity": 6,
    "teachingSupport": 0,
    "teacherInteraction": 3.5,
    "completedWell": true
  }' | jq
```

**Expected Response (400):**
```json
{
  "success": false,
  "message": "Validation errors",
  "errors": [
    {
      "field": "teachingClarity",
      "message": "Teaching clarity rating must be an integer between 1 and 5"
    }
  ]
}
```

### 3. ƒê√°nh gi√° l·∫ßn th·ª© 2 (ƒë√£ ƒë√°nh gi√° r·ªìi)
```bash
# Th·ª±c hi·ªán l·∫°i request t·∫°o ƒë√°nh gi√° cho c√πng m·ªôt lesson
curl -X POST "${BASE_URL}/student-evaluations/lessons/${LESSON_ID}/evaluate" \
  -H "Authorization: Bearer ${STUDENT_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "teachingClarity": 3,
    "teachingSupport": 3,
    "teacherInteraction": 3,
    "completedWell": false,
    "reason": "Kh√¥ng hi·ªÉu b√†i"
  }' | jq
```

**Expected Response (403):**
```json
{
  "success": false,
  "message": "Student has already evaluated this lesson"
}
```

### 4. C·∫≠p nh·∫≠t ƒë√°nh gi√° c·ªßa ng∆∞·ªùi kh√°c
```bash
# Gi·∫£ s·ª≠ EVALUATION_ID_OTHER_STUDENT l√† ƒë√°nh gi√° c·ªßa h·ªçc sinh kh√°c
export EVALUATION_ID_OTHER_STUDENT="675a1b2c3d4e5f6789012888"

curl -X PUT "${BASE_URL}/student-evaluations/${EVALUATION_ID_OTHER_STUDENT}" \
  -H "Authorization: Bearer ${STUDENT_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "teachingClarity": 1,
    "comments": "Hack attempt"
  }' | jq
```

**Expected Response (403):**
```json
{
  "success": false,
  "message": "You can only update your own evaluations"
}
```

---

## üìä C√°c Scenarios Th·ª±c T·∫ø

### Scenario 1: H·ªçc sinh ƒë√°nh gi√° t√≠ch c·ª±c
```bash
curl -X POST "${BASE_URL}/student-evaluations/lessons/${LESSON_ID}/evaluate" \
  -H "Authorization: Bearer ${STUDENT_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "teachingClarity": 5,
    "teachingSupport": 5,
    "teacherInteraction": 4,
    "completedWell": true,
    "comments": "C√¥ gi√°o d·∫°y r·∫•t hay, gi·∫£i th√≠ch t·ª´ng b∆∞·ªõc m·ªôt c√°ch chi ti·∫øt. Em ƒë√£ hi·ªÉu ƒë∆∞·ª£c b√†i h·ªçc v√† c√≥ th·ªÉ l√†m ƒë∆∞·ª£c c√°c b√†i t·∫≠p t∆∞∆°ng t·ª±."
  }' | jq
```

### Scenario 2: H·ªçc sinh ƒë√°nh gi√° ti√™u c·ª±c v·ªõi l√Ω do
```bash
curl -X POST "${BASE_URL}/student-evaluations/lessons/${LESSON_ID}/evaluate" \
  -H "Authorization: Bearer ${STUDENT_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "teachingClarity": 2,
    "teachingSupport": 2,
    "teacherInteraction": 3,
    "completedWell": false,
    "reason": "Gi√°o vi√™n n√≥i qu√° nhanh, em kh√¥ng k·ªãp ghi ch√©p v√† kh√¥ng hi·ªÉu ƒë∆∞·ª£c n·ªôi dung b√†i h·ªçc",
    "comments": "Em mong gi√°o vi√™n c√≥ th·ªÉ n√≥i ch·∫≠m h∆°n v√† gi·∫£i th√≠ch k·ªπ h∆°n c√°c kh√°i ni·ªám kh√≥."
  }' | jq
```

### Scenario 3: H·ªçc sinh ƒë√°nh gi√° trung b√¨nh
```bash
curl -X POST "${BASE_URL}/student-evaluations/lessons/${LESSON_ID}/evaluate" \
  -H "Authorization: Bearer ${STUDENT_TOKEN}" \
  -H "Content-Type: application/json" \
  -d '{
    "teachingClarity": 3,
    "teachingSupport": 4,
    "teacherInteraction": 3,
    "completedWell": true,
    "comments": "Ti·∫øt h·ªçc b√¨nh th∆∞·ªùng, em hi·ªÉu ƒë∆∞·ª£c ph·∫ßn c∆° b·∫£n nh∆∞ng v·∫´n c√≤n m·ªôt s·ªë ch·ªó ch∆∞a r√µ."
  }' | jq
```

---

## üîß Utility Scripts

### Script ƒë·ªÉ test to√†n b·ªô workflow
```bash
#!/bin/bash

# student-evaluation-test.sh
set -e

echo "üöÄ Testing Student Evaluation API Workflow..."

# 1. Ki·ªÉm tra c√≥ th·ªÉ ƒë√°nh gi√° kh√¥ng
echo "1. Checking if lesson can be evaluated..."
LESSON_INFO=$(curl -s -X GET "${BASE_URL}/student-evaluations/lessons/${LESSON_ID}/can-evaluate" \
  -H "Authorization: Bearer ${STUDENT_TOKEN}")

CAN_EVALUATE=$(echo $LESSON_INFO | jq -r '.canEvaluate')

if [ "$CAN_EVALUATE" = "true" ]; then
  echo "‚úÖ Lesson can be evaluated"
  
  # 2. T·∫°o ƒë√°nh gi√°
  echo "2. Creating evaluation..."
  EVALUATION_RESPONSE=$(curl -s -X POST "${BASE_URL}/student-evaluations/lessons/${LESSON_ID}/evaluate" \
    -H "Authorization: Bearer ${STUDENT_TOKEN}" \
    -H "Content-Type: application/json" \
    -d '{
      "teachingClarity": 4,
      "teachingSupport": 5,
      "teacherInteraction": 4,
      "completedWell": true,
      "comments": "Test evaluation from script"
    }')
  
  EVALUATION_ID=$(echo $EVALUATION_RESPONSE | jq -r '.data.evaluationId')
  echo "‚úÖ Evaluation created with ID: $EVALUATION_ID"
  
  # 3. C·∫≠p nh·∫≠t ƒë√°nh gi√°
  echo "3. Updating evaluation..."
  curl -s -X PUT "${BASE_URL}/student-evaluations/${EVALUATION_ID}" \
    -H "Authorization: Bearer ${STUDENT_TOKEN}" \
    -H "Content-Type: application/json" \
    -d '{
      "teachingClarity": 5,
      "comments": "Updated evaluation from script"
    }' > /dev/null
  echo "‚úÖ Evaluation updated"
  
  # 4. L·∫•y chi ti·∫øt ƒë√°nh gi√°
  echo "4. Getting evaluation detail..."
  curl -s -X GET "${BASE_URL}/student-evaluations/${EVALUATION_ID}" \
    -H "Authorization: Bearer ${STUDENT_TOKEN}" | jq '.data.evaluation'
  echo "‚úÖ Evaluation detail retrieved"
  
else
  echo "‚ùå Cannot evaluate lesson: $(echo $LESSON_INFO | jq -r '.message')"
fi

echo "üéâ Test completed!"
```

### Script ƒë·ªÉ l·∫•y th·ªëng k√™ ƒë√°nh gi√°
```bash
#!/bin/bash

# get-evaluation-stats.sh
echo "üìä Getting evaluation statistics..."

# L·∫•y t·∫•t c·∫£ ƒë√°nh gi√° c·ªßa h·ªçc sinh
ALL_EVALUATIONS=$(curl -s -X GET "${BASE_URL}/student-evaluations?limit=100" \
  -H "Authorization: Bearer ${STUDENT_TOKEN}")

TOTAL_EVALUATIONS=$(echo $ALL_EVALUATIONS | jq '.pagination.totalItems')
echo "Total evaluations: $TOTAL_EVALUATIONS"

# T√≠nh ƒëi·ªÉm trung b√¨nh
AVG_OVERALL=$(echo $ALL_EVALUATIONS | jq '.data.evaluations | map(.evaluation.overallRating) | add / length')
echo "Average overall rating: $AVG_OVERALL"

# ƒê·∫øm s·ªë l∆∞·ª£ng ƒë√°nh gi√° theo m√¥n
echo "Evaluations by subject:"
echo $ALL_EVALUATIONS | jq -r '.data.evaluations | group_by(.subject.code) | .[] | "\(.[0].subject.code): \(length) evaluations"'
```

---

## üìù Notes

- Thay th·∫ø `${STUDENT_TOKEN}` b·∫±ng JWT token th·ª±c c·ªßa h·ªçc sinh
- Thay th·∫ø `${LESSON_ID}` b·∫±ng ID c·ªßa lesson ƒë√£ completed v√† h·ªçc sinh c√≥ tham gia
- S·ª≠ d·ª•ng `jq` ƒë·ªÉ format JSON output ƒë·∫πp h∆°n
- T·∫•t c·∫£ API ƒë·ªÅu y√™u c·∫ßu authentication v·ªõi role `student`
- Ki·ªÉm tra response status code ƒë·ªÉ x√°c ƒë·ªãnh success/error

## üîç Debugging Tips

1. **Ki·ªÉm tra token h·ª£p l·ªá:**
   ```bash
   curl -X GET "${BASE_URL}/auth/me" \
     -H "Authorization: Bearer ${STUDENT_TOKEN}" | jq
   ```

2. **Ki·ªÉm tra lesson status:**
   ```bash
   curl -X GET "${BASE_URL}/schedules/lessons/${LESSON_ID}" \
     -H "Authorization: Bearer ${STUDENT_TOKEN}" | jq '.data.status'
   ```

3. **Ki·ªÉm tra attendance:**
   ```bash
   curl -X GET "${BASE_URL}/schedules/lessons/${LESSON_ID}" \
     -H "Authorization: Bearer ${STUDENT_TOKEN}" | jq '.data.attendance'
   ``` 