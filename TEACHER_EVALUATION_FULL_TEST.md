# Test Commands ƒê·∫ßy ƒê·ªß - API ƒê√°nh Gi√° Ti·∫øt H·ªçc C·ªßa Gi√°o Vi√™n

## üîê **Setup Environment**

```bash
# Base configuration
export BASE_URL="http://localhost:5000"
export API_URL="$BASE_URL/api/teacher-evaluations"

# Tokens (c·∫ßn thay b·∫±ng token th·∫≠t t·ª´ login)
export TEACHER1_TOKEN="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."  # Gi√°o vi√™n 1
export TEACHER2_TOKEN="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."  # Gi√°o vi√™n 2 (ƒë·ªÉ test unauthorized)
export STUDENT_TOKEN="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."   # H·ªçc sinh (ƒë·ªÉ test role)
export ADMIN_TOKEN="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."     # Admin

# Sample IDs (c·∫ßn thay b·∫±ng ID th·∫≠t t·ª´ database)
export LESSON_ID_TEACHER1="675a1b2c3d4e5f6789012345"  # Lesson c·ªßa Teacher1
export LESSON_ID_TEACHER2="675a1b2c3d4e5f6789012346"  # Lesson c·ªßa Teacher2
export LESSON_ID_NOT_COMPLETED="675a1b2c3d4e5f6789012347"  # Lesson ch∆∞a completed
export CLASS_ID="675a1b2c3d4e5f6789012348"
export SUBJECT_ID="675a1b2c3d4e5f6789012349"
export STUDENT1_ID="675a1b2c3d4e5f6789012350"
export STUDENT2_ID="675a1b2c3d4e5f6789012351"
export STUDENT3_ID="675a1b2c3d4e5f6789012352"
```

---

## üß™ **1. SECURITY TESTS - Ki·ªÉm Tra Quy·ªÅn Truy C·∫≠p**

### **Test 1.1: Kh√¥ng c√≥ token (401)**
```bash
echo "=== Test 1.1: No Token ==="
curl -X POST "$API_URL/lessons/$LESSON_ID_TEACHER1/evaluate" \
  -H "Content-Type: application/json" \
  -d '{
    "curriculumLesson": "Test",
    "content": "Test content",
    "rating": "A",
    "comments": "Test comments"
  }'
echo -e "\n"
```

### **Test 1.2: Token kh√¥ng h·ª£p l·ªá (401)**
```bash
echo "=== Test 1.2: Invalid Token ==="
curl -X POST "$API_URL/lessons/$LESSON_ID_TEACHER1/evaluate" \
  -H "Authorization: Bearer invalid_token_here" \
  -H "Content-Type: application/json" \
  -d '{
    "curriculumLesson": "Test",
    "content": "Test content", 
    "rating": "A",
    "comments": "Test comments"
  }'
echo -e "\n"
```

### **Test 1.3: Role student c·ªë g·∫Øng ƒë√°nh gi√° (403)**
```bash
echo "=== Test 1.3: Student Role Access Denied ==="
curl -X POST "$API_URL/lessons/$LESSON_ID_TEACHER1/evaluate" \
  -H "Authorization: Bearer $STUDENT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "curriculumLesson": "Test",
    "content": "Test content",
    "rating": "A", 
    "comments": "Test comments"
  }'
echo -e "\n"
```

### **Test 1.4: Teacher2 c·ªë g·∫Øng ƒë√°nh gi√° lesson c·ªßa Teacher1 (403)**
```bash
echo "=== Test 1.4: Teacher Evaluating Other Teacher's Lesson ==="
curl -X POST "$API_URL/lessons/$LESSON_ID_TEACHER1/evaluate" \
  -H "Authorization: Bearer $TEACHER2_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "curriculumLesson": "Ti·∫øt 15: Unauthorized Test",
    "content": "Teacher2 trying to evaluate Teacher1 lesson",
    "rating": "A",
    "comments": "This should fail"
  }'
echo -e "\n"
```

### **Test 1.5: ƒê√°nh gi√° lesson ch∆∞a completed (400)**
```bash
echo "=== Test 1.5: Evaluate Non-Completed Lesson ==="
curl -X POST "$API_URL/lessons/$LESSON_ID_NOT_COMPLETED/evaluate" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "curriculumLesson": "Ti·∫øt 16: Not Completed",
    "content": "This lesson is not completed yet",
    "rating": "A",
    "comments": "Should fail because lesson not completed"
  }'
echo -e "\n"
```

### **Test 1.6: Lesson kh√¥ng t·ªìn t·∫°i (404)**
```bash
echo "=== Test 1.6: Non-Existent Lesson ==="
curl -X POST "$API_URL/lessons/675a1b2c3d4e5f6789999999/evaluate" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "curriculumLesson": "Ti·∫øt 17: Non-existent",
    "content": "This lesson does not exist",
    "rating": "A",
    "comments": "Should fail - lesson not found"
  }'
echo -e "\n"
```

---

## ‚úÖ **2. VALIDATION TESTS - Ki·ªÉm Tra Validation**

### **Test 2.1: Thi·∫øu field b·∫Øt bu·ªôc**
```bash
echo "=== Test 2.1: Missing Required Fields ==="
curl -X POST "$API_URL/lessons/$LESSON_ID_TEACHER1/evaluate" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "curriculumLesson": "Ti·∫øt 15: Missing fields"
  }'
echo -e "\n"
```

### **Test 2.2: Rating kh√¥ng h·ª£p l·ªá**
```bash
echo "=== Test 2.2: Invalid Rating ==="
curl -X POST "$API_URL/lessons/$LESSON_ID_TEACHER1/evaluate" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "curriculumLesson": "Ti·∫øt 15: Invalid Rating",
    "content": "Test content",
    "rating": "S",
    "comments": "Invalid rating test"
  }'
echo -e "\n"
```

### **Test 2.3: Content qu√° d√†i**
```bash
echo "=== Test 2.3: Content Too Long ==="
LONG_CONTENT=$(printf 'A%.0s' {1..1001})  # 1001 characters
curl -X POST "$API_URL/lessons/$LESSON_ID_TEACHER1/evaluate" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" \
  -H "Content-Type: application/json" \
  -d "{
    \"curriculumLesson\": \"Ti·∫øt 15: Long Content\",
    \"content\": \"$LONG_CONTENT\",
    \"rating\": \"A\",
    \"comments\": \"Content too long test\"
  }"
echo -e "\n"
```

### **Test 2.4: Score ki·ªÉm tra mi·ªáng kh√¥ng h·ª£p l·ªá**
```bash
echo "=== Test 2.4: Invalid Oral Test Score ==="
curl -X POST "$API_URL/lessons/$LESSON_ID_TEACHER1/evaluate" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "curriculumLesson": "Ti·∫øt 15: Invalid Score",
    "content": "Test content",
    "rating": "A",
    "comments": "Test comments",
    "oralTests": [
      {
        "student": "'$STUDENT1_ID'",
        "score": 15,
        "question": "Invalid score test",
        "comment": "Score over 10"
      }
    ]
  }'
echo -e "\n"
```

---

## üéØ **3. SUCCESS TESTS - Test Th√†nh C√¥ng**

### **Test 3.1: T·∫°o ƒë√°nh gi√° c∆° b·∫£n th√†nh c√¥ng**
```bash
echo "=== Test 3.1: Create Basic Evaluation Success ==="
RESPONSE=$(curl -s -X POST "$API_URL/lessons/$LESSON_ID_TEACHER1/evaluate" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "curriculumLesson": "Ti·∫øt 15: ƒê·∫°o h√†m c·ªßa h√†m s·ªë",
    "content": "Kh√°i ni·ªám ƒë·∫°o h√†m, quy t·∫Øc t√≠nh ƒë·∫°o h√†m c∆° b·∫£n, ·ª©ng d·ª•ng ƒë·∫°o h√†m trong gi·∫£i to√°n",
    "description": "H·ªçc sinh ƒë∆∞·ª£c l√†m quen v·ªõi kh√°i ni·ªám ƒë·∫°o h√†m v√† c√°c quy t·∫Øc c∆° b·∫£n",
    "rating": "A",
    "comments": "L·ªõp h·ªçc t√≠ch c·ª±c, h·ªçc sinh hi·ªÉu b√†i t·ªët. C·∫ßn c·ªßng c·ªë th√™m ph·∫ßn b√†i t·∫≠p ·ª©ng d·ª•ng."
  }')

echo "$RESPONSE" | jq '.'

# L·∫•y evaluation ID ƒë·ªÉ d√πng cho tests ti·∫øp theo
export EVALUATION_ID=$(echo "$RESPONSE" | jq -r '.data.evaluationId')
echo "Created Evaluation ID: $EVALUATION_ID"
echo -e "\n"
```

### **Test 3.2: T·∫°o ƒë√°nh gi√° ƒë·∫ßy ƒë·ªß v·ªõi t·∫•t c·∫£ th√¥ng tin**
```bash
echo "=== Test 3.2: Create Full Evaluation Success ==="
curl -X POST "$API_URL/lessons/$LESSON_ID_TEACHER2/evaluate" \
  -H "Authorization: Bearer $TEACHER2_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "curriculumLesson": "Ti·∫øt 20: T√≠ch ph√¢n",
    "content": "Kh√°i ni·ªám t√≠ch ph√¢n, ph∆∞∆°ng ph√°p t√≠nh t√≠ch ph√¢n, ·ª©ng d·ª•ng t√≠ch ph√¢n",
    "description": "B√†i h·ªçc v·ªÅ t√≠ch ph√¢n v√† ·ª©ng d·ª•ng th·ª±c t·∫ø",
    "rating": "A+",
    "comments": "L·ªõp h·ªçc xu·∫•t s·∫Øc, t·∫•t c·∫£ h·ªçc sinh ƒë·ªÅu tham gia t√≠ch c·ª±c",
    "evaluationDetails": {
      "studentEngagement": "excellent",
      "comprehensionLevel": "excellent", 
      "objectiveCompletion": "fully"
    },
    "absentStudents": [
      {
        "student": "'$STUDENT1_ID'",
        "isExcused": true,
        "reason": "B·ªánh, c√≥ gi·∫•y xin ph√©p c·ªßa b√°c sƒ©"
      },
      {
        "student": "'$STUDENT2_ID'",
        "isExcused": false,
        "reason": "V·∫Øng kh√¥ng b√°o tr∆∞·ªõc"
      }
    ],
    "oralTests": [
      {
        "student": "'$STUDENT3_ID'",
        "score": 9.5,
        "question": "T√≠nh t√≠ch ph√¢n c·ªßa h√†m s·ªë f(x) = x¬≤ t·ª´ 0 ƒë·∫øn 2",
        "comment": "Tr·∫£ l·ªùi xu·∫•t s·∫Øc, ph∆∞∆°ng ph√°p ƒë√∫ng, t√≠nh to√°n ch√≠nh x√°c"
      }
    ],
    "violations": [
      {
        "student": "'$STUDENT2_ID'",
        "description": "S·ª≠ d·ª•ng ƒëi·ªán tho·∫°i trong gi·ªù h·ªçc",
        "type": "disruptive",
        "severity": "moderate",
        "action": "Thu ƒëi·ªán tho·∫°i, tr·∫£ cu·ªëi gi·ªù v√† nh·∫Øc nh·ªü"
      }
    ]
  }' | jq '.'
echo -e "\n"
```

---

## üîÑ **4. UPDATE TESTS - Test C·∫≠p Nh·∫≠t**

### **Test 4.1: C·∫≠p nh·∫≠t ƒë√°nh gi√° th√†nh c√¥ng**
```bash
echo "=== Test 4.1: Update Evaluation Success ==="
curl -X PUT "$API_URL/$EVALUATION_ID" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "rating": "A+",
    "comments": "C·∫≠p nh·∫≠t: Sau khi xem l·∫°i, l·ªõp h·ªçc th·ª±c s·ª± xu·∫•t s·∫Øc",
    "evaluationDetails": {
      "studentEngagement": "excellent",
      "comprehensionLevel": "excellent",
      "objectiveCompletion": "fully"
    }
  }' | jq '.'
echo -e "\n"
```

### **Test 4.2: Teacher kh√°c c·ªë g·∫Øng c·∫≠p nh·∫≠t (403)**
```bash
echo "=== Test 4.2: Unauthorized Update ==="
curl -X PUT "$API_URL/$EVALUATION_ID" \
  -H "Authorization: Bearer $TEACHER2_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "rating": "B",
    "comments": "Trying to update other teacher evaluation"
  }'
echo -e "\n"
```

---

## ‚ûï **5. ADD COMPONENTS TESTS - Test Th√™m Th√†nh Ph·∫ßn**

### **Test 5.1: Th√™m h·ªçc sinh v·∫Øng**
```bash
echo "=== Test 5.1: Add Absent Student ==="
curl -X POST "$API_URL/$EVALUATION_ID/absent-students" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "studentId": "'$STUDENT1_ID'",
    "isExcused": true,
    "reason": "ƒêi kh√°m b·ªánh ƒë·ªãnh k·ª≥, c√≥ gi·∫•y xin ph√©p"
  }' | jq '.'
echo -e "\n"
```

### **Test 5.2: Th√™m ki·ªÉm tra mi·ªáng**
```bash
echo "=== Test 5.2: Add Oral Test ==="
curl -X POST "$API_URL/$EVALUATION_ID/oral-tests" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "studentId": "'$STUDENT2_ID'",
    "score": 8.5,
    "question": "T√≠nh ƒë·∫°o h√†m c·ªßa h√†m s·ªë f(x) = x¬≥ - 2x¬≤ + 3x - 1",
    "comment": "Tr·∫£ l·ªùi ch√≠nh x√°c, tr√¨nh b√†y r√µ r√†ng, c√≥ ph∆∞∆°ng ph√°p"
  }' | jq '.'
echo -e "\n"
```

### **Test 5.3: Th√™m vi ph·∫°m**
```bash
echo "=== Test 5.3: Add Violation ==="
curl -X POST "$API_URL/$EVALUATION_ID/violations" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "studentId": "'$STUDENT3_ID'",
    "description": "N√≥i chuy·ªán ri√™ng, l√†m ·∫£nh h∆∞·ªüng ƒë·∫øn b·∫°n kh√°c",
    "type": "disruptive",
    "severity": "minor",
    "action": "Nh·∫Øc nh·ªü v√† chuy·ªÉn ch·ªó ng·ªìi"
  }' | jq '.'
echo -e "\n"
```

### **Test 5.4: Th√™m nhi·ªÅu ki·ªÉm tra mi·ªáng**
```bash
echo "=== Test 5.4: Add Multiple Oral Tests ==="

# H·ªçc sinh 1
curl -X POST "$API_URL/$EVALUATION_ID/oral-tests" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "studentId": "'$STUDENT1_ID'",
    "score": 7.0,
    "question": "N√™u ƒë·ªãnh nghƒ©a ƒë·∫°o h√†m",
    "comment": "Tr·∫£ l·ªùi ƒë√∫ng nh∆∞ng ch∆∞a ƒë·∫ßy ƒë·ªß"
  }' | jq '.'

# H·ªçc sinh 3  
curl -X POST "$API_URL/$EVALUATION_ID/oral-tests" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "studentId": "'$STUDENT3_ID'",
    "score": 9.0,
    "question": "·ª®ng d·ª•ng ƒë·∫°o h√†m t√¨m c·ª±c tr·ªã c·ªßa h√†m s·ªë",
    "comment": "Xu·∫•t s·∫Øc, hi·ªÉu s√¢u v√† √°p d·ª•ng t·ªët"
  }' | jq '.'
echo -e "\n"
```

---

## üìã **6. RETRIEVAL TESTS - Test L·∫•y D·ªØ Li·ªáu**

### **Test 6.1: L·∫•y chi ti·∫øt ƒë√°nh gi√°**
```bash
echo "=== Test 6.1: Get Evaluation Detail ==="
curl -X GET "$API_URL/$EVALUATION_ID" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" | jq '.'
echo -e "\n"
```

### **Test 6.2: L·∫•y danh s√°ch ƒë√°nh gi√°**
```bash
echo "=== Test 6.2: Get Teacher Evaluations List ==="
curl -X GET "$API_URL" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" | jq '.'
echo -e "\n"
```

### **Test 6.3: L·∫•y danh s√°ch v·ªõi filter**
```bash
echo "=== Test 6.3: Get Evaluations with Filters ==="
curl -X GET "$API_URL?rating=A&status=draft&page=1&limit=5" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" | jq '.'
echo -e "\n"
```

### **Test 6.4: L·∫•y th·ªëng k√™**
```bash
echo "=== Test 6.4: Get Evaluation Statistics ==="
curl -X GET "$API_URL/stats/summary" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" | jq '.'
echo -e "\n"
```

---

## üîÑ **7. STATUS CHANGE TESTS - Test Thay ƒê·ªïi Tr·∫°ng Th√°i**

### **Test 7.1: Complete ƒë√°nh gi√°**
```bash
echo "=== Test 7.1: Complete Evaluation ==="
curl -X POST "$API_URL/$EVALUATION_ID/complete" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" | jq '.'
echo -e "\n"
```

### **Test 7.2: Submit ƒë√°nh gi√°**
```bash
echo "=== Test 7.2: Submit Evaluation ==="
curl -X POST "$API_URL/$EVALUATION_ID/submit" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" | jq '.'
echo -e "\n"
```

### **Test 7.3: C·ªë g·∫Øng c·∫≠p nh·∫≠t sau khi submit (400)**
```bash
echo "=== Test 7.3: Try Update After Submit ==="
curl -X PUT "$API_URL/$EVALUATION_ID" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "rating": "B",
    "comments": "This should fail - already submitted"
  }'
echo -e "\n"
```

### **Test 7.4: C·ªë g·∫Øng th√™m vi ph·∫°m sau khi submit (400)**
```bash
echo "=== Test 7.4: Try Add Violation After Submit ==="
curl -X POST "$API_URL/$EVALUATION_ID/violations" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "studentId": "'$STUDENT1_ID'",
    "description": "This should fail",
    "type": "other",
    "severity": "minor"
  }'
echo -e "\n"
```

---

## üîÅ **8. DUPLICATE TESTS - Test Tr√πng L·∫∑p**

### **Test 8.1: C·ªë g·∫Øng t·∫°o ƒë√°nh gi√° th·ª© 2 cho c√πng lesson (409)**
```bash
echo "=== Test 8.1: Try Create Duplicate Evaluation ==="
curl -X POST "$API_URL/lessons/$LESSON_ID_TEACHER1/evaluate" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "curriculumLesson": "Ti·∫øt 15: Duplicate Test",
    "content": "This should fail - already evaluated",
    "rating": "A",
    "comments": "Duplicate evaluation test"
  }'
echo -e "\n"
```

---

## üéØ **9. ADMIN ACCESS TESTS - Test Quy·ªÅn Admin**

### **Test 9.1: Admin xem ƒë√°nh gi√° c·ªßa teacher (200)**
```bash
echo "=== Test 9.1: Admin View Teacher Evaluation ==="
curl -X GET "$API_URL/$EVALUATION_ID" \
  -H "Authorization: Bearer $ADMIN_TOKEN" | jq '.'
echo -e "\n"
```

---

## üìä **10. COMPREHENSIVE WORKFLOW TEST**

### **Test 10.1: Workflow ho√†n ch·ªânh t·ª´ ƒë·∫ßu ƒë·∫øn cu·ªëi**
```bash
echo "=== Test 10.1: Complete Workflow ==="

# T·∫°o lesson ID m·ªõi cho test n√†y (gi·∫£ s·ª≠)
export NEW_LESSON_ID="675a1b2c3d4e5f6789012360"

echo "Step 1: Create new evaluation"
NEW_EVAL_RESPONSE=$(curl -s -X POST "$API_URL/lessons/$NEW_LESSON_ID/evaluate" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "curriculumLesson": "Ti·∫øt 25: Workflow Test",
    "content": "Complete workflow test lesson",
    "rating": "B+",
    "comments": "Initial evaluation for workflow test"
  }')

NEW_EVAL_ID=$(echo "$NEW_EVAL_RESPONSE" | jq -r '.data.evaluationId')
echo "Created Evaluation: $NEW_EVAL_ID"

echo "Step 2: Add absent students"
curl -s -X POST "$API_URL/$NEW_EVAL_ID/absent-students" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "studentId": "'$STUDENT1_ID'",
    "isExcused": false,
    "reason": "Workflow test - absent"
  }' > /dev/null

echo "Step 3: Add oral tests"
curl -s -X POST "$API_URL/$NEW_EVAL_ID/oral-tests" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "studentId": "'$STUDENT2_ID'",
    "score": 8.0,
    "question": "Workflow test question",
    "comment": "Good answer"
  }' > /dev/null

echo "Step 4: Add violations"
curl -s -X POST "$API_URL/$NEW_EVAL_ID/violations" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "studentId": "'$STUDENT3_ID'",
    "description": "Workflow test violation",
    "type": "disruptive",
    "severity": "minor"
  }' > /dev/null

echo "Step 5: Update evaluation"
curl -s -X PUT "$API_URL/$NEW_EVAL_ID" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "rating": "A",
    "comments": "Updated after adding components"
  }' > /dev/null

echo "Step 6: Complete evaluation"
curl -s -X POST "$API_URL/$NEW_EVAL_ID/complete" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" > /dev/null

echo "Step 7: Submit evaluation"
curl -s -X POST "$API_URL/$NEW_EVAL_ID/submit" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" > /dev/null

echo "Step 8: View final result"
curl -X GET "$API_URL/$NEW_EVAL_ID" \
  -H "Authorization: Bearer $TEACHER1_TOKEN" | jq '.data | {
    evaluationId,
    status,
    evaluation: .evaluation.rating,
    summary,
    submittedAt
  }'

echo "Workflow completed successfully!"
echo -e "\n"
```

---

## üöÄ **11. PERFORMANCE TESTS**

### **Test 11.1: Concurrent evaluations**
```bash
echo "=== Test 11.1: Concurrent Evaluations ==="

# T·∫°o 5 ƒë√°nh gi√° ƒë·ªìng th·ªùi
for i in {1..5}; do
  (
    LESSON_ID="675a1b2c3d4e5f678901236$i"
    curl -s -X POST "$API_URL/lessons/$LESSON_ID/evaluate" \
      -H "Authorization: Bearer $TEACHER1_TOKEN" \
      -H "Content-Type: application/json" \
      -d "{
        \"curriculumLesson\": \"Ti·∫øt $i: Concurrent Test\",
        \"content\": \"Performance test lesson $i\",
        \"rating\": \"A\",
        \"comments\": \"Concurrent evaluation test $i\"
      }" | jq -r '.success'
  ) &
done

wait
echo "All concurrent evaluations completed"
echo -e "\n"
```

---

## üìù **12. RUN ALL TESTS SCRIPT**

```bash
#!/bin/bash
echo "üß™ STARTING COMPREHENSIVE TEACHER EVALUATION API TESTS"
echo "======================================================"

# Function to run test and check result
run_test() {
  local test_name="$1"
  local expected_status="$2"
  shift 2
  
  echo "Running: $test_name"
  local response=$(eval "$@")
  local actual_status=$(echo "$response" | jq -r '.success // "null"')
  
  if [[ "$actual_status" == "$expected_status" ]]; then
    echo "‚úÖ PASS: $test_name"
  else
    echo "‚ùå FAIL: $test_name (Expected: $expected_status, Got: $actual_status)"
    echo "Response: $response"
  fi
  echo ""
}

# Security Tests
echo "üîê SECURITY TESTS"
echo "=================="

run_test "No Token Test" "null" \
  'curl -s -X POST "$API_URL/lessons/$LESSON_ID_TEACHER1/evaluate" -H "Content-Type: application/json" -d "{\"curriculumLesson\":\"Test\",\"content\":\"Test\",\"rating\":\"A\",\"comments\":\"Test\"}"'

run_test "Invalid Token Test" "null" \
  'curl -s -X POST "$API_URL/lessons/$LESSON_ID_TEACHER1/evaluate" -H "Authorization: Bearer invalid" -H "Content-Type: application/json" -d "{\"curriculumLesson\":\"Test\",\"content\":\"Test\",\"rating\":\"A\",\"comments\":\"Test\"}"'

# Validation Tests
echo "‚úÖ VALIDATION TESTS"
echo "==================="

run_test "Missing Required Fields" "false" \
  'curl -s -X POST "$API_URL/lessons/$LESSON_ID_TEACHER1/evaluate" -H "Authorization: Bearer $TEACHER1_TOKEN" -H "Content-Type: application/json" -d "{\"curriculumLesson\":\"Test\"}"'

run_test "Invalid Rating" "false" \
  'curl -s -X POST "$API_URL/lessons/$LESSON_ID_TEACHER1/evaluate" -H "Authorization: Bearer $TEACHER1_TOKEN" -H "Content-Type: application/json" -d "{\"curriculumLesson\":\"Test\",\"content\":\"Test\",\"rating\":\"S\",\"comments\":\"Test\"}"'

# Success Tests
echo "üéØ SUCCESS TESTS"
echo "================"

run_test "Create Basic Evaluation" "true" \
  'curl -s -X POST "$API_URL/lessons/$LESSON_ID_TEACHER1/evaluate" -H "Authorization: Bearer $TEACHER1_TOKEN" -H "Content-Type: application/json" -d "{\"curriculumLesson\":\"Test Success\",\"content\":\"Test content\",\"rating\":\"A\",\"comments\":\"Test comments\"}"'

echo "üèÅ ALL TESTS COMPLETED"
echo "======================"
```

---

## üìã **Checklist Validation Security**

### ‚úÖ **ƒê√£ Test:**
1. **Authentication**: No token, invalid token
2. **Authorization**: Wrong role (student), wrong teacher
3. **Resource Ownership**: Teacher ch·ªâ ƒë√°nh gi√° lesson c·ªßa m√¨nh
4. **Business Logic**: Lesson ph·∫£i completed, kh√¥ng duplicate
5. **Data Validation**: Required fields, format validation
6. **State Management**: Kh√¥ng s·ª≠a sau khi submit
7. **Input Sanitization**: Length limits, enum values

### üîí **Security Guarantees:**
- ‚úÖ Ch·ªâ gi√°o vi√™n d·∫°y ti·∫øt ƒë√≥ m·ªõi ƒë∆∞·ª£c ƒë√°nh gi√°
- ‚úÖ Lesson ph·∫£i ·ªü tr·∫°ng th√°i 'completed'
- ‚úÖ M·ªói lesson ch·ªâ ƒë√°nh gi√° ƒë∆∞·ª£c 1 l·∫ßn
- ‚úÖ Kh√¥ng th·ªÉ s·ª≠a ƒë√°nh gi√° ƒë√£ submit
- ‚úÖ T·∫•t c·∫£ h·ªçc sinh ph·∫£i thu·ªôc l·ªõp ƒë√≥
- ‚úÖ Validation ƒë·∫ßy ƒë·ªß cho t·∫•t c·∫£ input

Ch·∫°y script n√†y ƒë·ªÉ test to√†n b·ªô h·ªá th·ªëng! üöÄ